{"version":3,"file":"index.js","sources":["../../../src/lib/store/src/local.js","../../../src/lib/store/src/session.js","../../../src/lib/store/index.js"],"sourcesContent":["const local = localStorage\r\nconst _set = local.setItem.bind(local)\r\nconst _get = local.getItem.bind(local)\r\nconst _remove = local.removeItem.bind(local)\r\nconst _parse = v => JSON.parse(_get(v))\r\nconst _stringify = JSON.stringify\r\nconst isString = v => typeof v === 'string'\r\nconst isObject = v => Object.prototype.toString.call(v) === '[object Object]'\r\nconst isNum = n => (typeof n == 'symbol' ? false : !isNaN(parseFloat(n)) && isFinite(n))\r\n\r\nconst set = function (a, b) {\r\n    if (isString(a)) {\r\n        _set(a, isString(b) ? b : _stringify(b))\r\n    } else if (isObject(a)) {\r\n        for (let k in a) {\r\n            _set(k, isString(a[k]) ? a[k] : _stringify(a[k]))\r\n        }\r\n    }\r\n}\r\n\r\nconst setExpired = function (...arg) {\r\n    let [a, b, c] = arg\r\n    let d = +new Date()\r\n    let fn = function (k, v, t) {\r\n        _set(\r\n            k,\r\n            _stringify({\r\n                startTime: d, //创建并存入时间戳\r\n                expiredTime: t, //过期时间\r\n                value: v\r\n            })\r\n        )\r\n    }\r\n    if (arg.length == 1) {\r\n        //设置多个值\r\n        if (isObject(a)) {\r\n            for (let k in a) {\r\n                fn(k, a[k], 0)\r\n            }\r\n        }\r\n    } else if (arg.length == 2) {\r\n        if (isString(a)) {\r\n            fn(a, 0, b)\r\n        } else if (isObject(a) && isNum(b)) {\r\n            for (let k in a) {\r\n                fn(k, a[k], Number(b))\r\n            }\r\n        }\r\n    } else if (arg.length == 3) {\r\n        if (isString(a) && isNum(c)) {\r\n            fn(a, b, Number(c))\r\n        }\r\n    }\r\n}\r\n\r\nconst get = function (k) {\r\n    if (isString(k)) {\r\n        return _parse(k)\r\n    } else if (Array.isArray(k)) {\r\n        return k.reduce((p, c) => {\r\n            if (isString(c) && c in local) {\r\n                p[c] = _parse(c)\r\n            }\r\n            return p\r\n        }, {})\r\n    }\r\n}\r\n\r\n/**\r\n * @description: 获取带过期时间的缓存\r\n * @return {*}\r\n * @param {*} k\r\n */\r\nconst getExpired = function (k) {\r\n    // 如果是字符串，则获取该缓存\r\n    if(isString(k)){\r\n        let v = _parse(k)\r\n        if (v && 'startTime' in v) {\r\n            // 如果大于就是过期了，如果小于或等于就还没过期\r\n            if (new Date() - v.startTime > v.expiredTime) {\r\n                _remove(k)\r\n                return false\r\n            } else {\r\n                return v.value\r\n            }\r\n        } else {\r\n            return null\r\n        }\r\n    }else {\r\n        let ret = {}\r\n        for(let i=0;i<k.length;i++){\r\n            let key = k[i]\r\n            if(isString(key)){\r\n                let v = _parse(key)\r\n                if(v && 'startTime' in v){\r\n                    // 如果大于就是过期了，如果小于或等于就还没过期\r\n                    if (new Date() - v.startTime > v.expiredTime) {\r\n                        _remove(k)\r\n                    } else {\r\n                        ret[key]= v.value\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return ret\r\n    }\r\n}\r\n\r\nconst del = function (k) {\r\n    if (isString(k)) {\r\n        _remove(k)\r\n    } else if (Array.isArray(k)) {\r\n        for (let i = 0, len = k.length; i < len; i++) {\r\n            let j = k[i]\r\n            if (isString(j)) {\r\n                _remove(j)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst clearAll = function () {\r\n    local.clear()\r\n}\r\n\r\nconst clearAllExpired = function () {\r\n    let keys = Object.keys(local)\r\n    let len = keys.length\r\n    for (let i = 0; i < len; i++) {\r\n        let o = _parse(k)\r\n        if (o && 'expiredTime' in o) _remove(k)\r\n    }\r\n}\r\n\r\nconst each = function (cb) {\r\n    let a = Object.keys(localStorage)\r\n    for (let i = 0, len = a.length; i < len; i++) {\r\n        let k = a[i]\r\n        let v = _parse(k)\r\n        cb(k, v)\r\n    }\r\n}\r\n\r\nexport default {\r\n    set,\r\n    get,\r\n    del,\r\n    each,\r\n    setExpired,\r\n    getExpired,\r\n    clearAll,\r\n    clearAllExpired\r\n}\r\n","const session = sessionStorage\r\nconst _get = session.getItem.bind(session)\r\nconst _set = session.setItem.bind(session)\r\nconst _remove = session.removeItem.bind(session)\r\nconst _clear = session.clear.bind(session)\r\nconst _stringify = JSON.stringify\r\nconst _parse = v => JSON.parse(_get(v))\r\nconst isString = v => typeof v === 'string'\r\nconst isObject = v => Object.prototype.toString.call(v) === '[object Object]'\r\nconst isArray = Array.isArray\r\n\r\nconst get = function (k) {\r\n    if (isString(k)) {\r\n        try {\r\n            return _parse(k)\r\n        } catch (e) {\r\n            return _get(k)\r\n        }\r\n    } else if (isArray(k)) {\r\n        return k.reduce((p, c) => {\r\n            let i = _parse(c)\r\n            i && (p[c] = i)\r\n            return p\r\n        }, {})\r\n    }\r\n}\r\n\r\nconst set = function (k, v) {\r\n    if (isString(k)) {\r\n        _set(k, _stringify(v)) //set(key,val)\r\n    } else if (isArray(k)) {\r\n        //set([{key1:val1},{key2:val2}]) or set([{key1:val1,k11:val22},{key2:val2}])\r\n        for (let i = 0; i < k.length; i++) {\r\n            let j = k[i]\r\n            if (isObject(j)) {\r\n                for (let k in j) {\r\n                    _set(k, isString(j[k]) ? j[k] : _stringify(j[k]))\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst del = function (k) {\r\n    if (isString(k)) {\r\n        _remove(k)\r\n    } else if (Array.isArray(k)) {\r\n        for (let i = 0, len = k.length; i < len; i++) {\r\n            let j = k[i]\r\n            isString(j) && _remove(j)\r\n        }\r\n    }\r\n}\r\n\r\nconst clearAll = function () {\r\n    session.clear()\r\n}\r\n\r\nconst each = function (cb) {\r\n    let arr = Object.keys(sessionStorage)\r\n    for (let i = 0; i < arr.length; i++) {\r\n        cb(arr[i], get(arr[i]))\r\n    }\r\n}\r\n\r\nexport default {\r\n    get,\r\n    set,\r\n    del,\r\n    clearAll,\r\n    each\r\n}\r\n","/*\r\n * @Author: your name\r\n * @Date: 2021-06-06 15:55:08\r\n * @LastEditTime: 2021-06-08 22:09:20\r\n * @LastEditors: Please set LastEditors\r\n * @Description: In User Settings Edit\r\n * @FilePath: \\rutils\\src\\lib\\store\\index.js\r\n */\r\n\r\nimport local from './src/local'\r\nimport session from './src/session'\r\n\r\nexport default {\r\n    local,\r\n    session\r\n}\r\n"],"names":["_parse","v","JSON","parse","_get","isString","isObject","Object","prototype","toString","call","isNum","n","_typeof","isNaN","parseFloat","isFinite","get","k","e","isArray","reduce","p","c","i","local","localStorage","_set","setItem","bind","getItem","_remove","removeItem","_stringify","stringify","set","a","b","Array","del","len","length","j","each","cb","keys","setExpired","arg","fn","t","startTime","d","expiredTime","value","Date","Number","getExpired","ret","key","clearAll","clear","clearAllExpired","o","session","sessionStorage","arr"],"mappings":"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"}